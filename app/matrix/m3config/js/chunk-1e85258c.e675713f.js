(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1e85258c"],{2763:function(e,t,o){},"849a":function(e,t,o){"use strict";o("9eec9")},"9eec9":function(e,t,o){},b78d:function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-container",[o("el-header",[o("el-input",{attrs:{placeholder:"搜索",clearable:""},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),o("el-dropdown",{attrs:{placement:"top-start",trigger:"click"}},[o("el-tooltip",{attrs:{content:"导出、导入"}},[o("el-button",{staticStyle:{color:"#333333","padding-left":"10px"},attrs:{type:"text",icon:"el-icon-menu"}})],1),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[o("div",{staticClass:"tool-box"},[o("div",{staticClass:"tool"},[o("div",[e._v("导入")]),o("p",[o("label",{attrs:{for:"auto-file-upload"}},[o("span",{staticClass:"el-icon-download",staticStyle:{cursor:"pointer","font-size":"16px",padding:"10px"}})]),o("input",{staticStyle:{display:"none"},attrs:{id:"auto-file-upload",type:"file",required:"required"},on:{change:e.onImport}})])]),o("div",{staticClass:"tool",on:{click:function(t){return e.onExport(null)}}},[o("div",[e._v("导出")]),o("p",[o("el-button",{attrs:{type:"text"}},[o("span",{staticClass:"el-icon-download",staticStyle:{cursor:"pointer","font-size":"16px"}})])],1)])])])],1)],1),o("el-main",[o("el-tree",{ref:"tree",staticStyle:{background:"transparent"},attrs:{data:e.treeData,props:e.defaultProps,"node-key":"key","highlight-current":"",accordion:"","filter-node-method":e.onNodeFilter,"expand-on-click-node":!0,"auto-expand-parent":"","default-expanded-keys":e.defaultExpandedKeys},on:{"node-click":e.onNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,i=t.data;return o("span",{staticStyle:{width:"100%",height:"30px","line-height":"30px"},on:{mouseenter:function(t){return e.onMouseEnter(i)},mouseleave:function(t){return e.onMouseLeave(i)}}},[i.dir?o("span",[e.pickTypeFromLabel(n.label,"jobs")?o("i",{staticClass:"el-icon-timer",staticStyle:{color:"#FFC107"}}):e.pickTypeFromLabel(n.label,"rules")?o("i",{staticClass:"el-icon-bank-card",staticStyle:{color:"#FFC107"}}):e.pickTypeFromLabel(n.label,"hosts")?o("i",{staticClass:"el-icon-s-platform",staticStyle:{color:"#FFC107"}}):e.pickTypeFromLabel(n.label,"lock")?o("i",{staticClass:"el-icon-lock",staticStyle:{color:"#FFC107"}}):e.pickTypeFromLabel(n.label,"notify")?o("i",{staticClass:"el-icon-warning",staticStyle:{color:"#FFC107"}}):o("i",{staticClass:"el-icon-folder",staticStyle:{color:"#FFC107"}}),"/"===n.label?o("span",[e._v(" 我的配置("+e._s(i.nodes.length)+")")]):o("span",[e._v(" "+e._s(e.pickLabel(n.label))+"("+e._s(i.nodes.length)+")")]),o("el-dropdown",{directives:[{name:"show",rawName:"v-show",value:i.show,expression:"data.show"}],staticStyle:{float:"right",width:"14px",margin:"0 5px"}},[o("span",{staticClass:"el-dropdown-link"},[o("i",{staticClass:"el-icon-more el-icon--right"})]),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[o("el-dropdown-item",{attrs:{icon:"el-icon-refresh"},nativeOn:{click:function(t){return e.onRefresh(i)}}},[e._v("刷新")]),o("el-dropdown-item",{attrs:{icon:"el-icon-plus",divided:""},nativeOn:{click:function(t){return e.onNewFile(i)}}},[e._v("新建")]),o("el-dropdown-item",{attrs:{icon:"el-icon-folder-add"},nativeOn:{click:function(t){return e.onNewDir(i)}}},[e._v("新建目录")]),o("el-dropdown-item",{attrs:{icon:"el-icon-edit-outline",divided:""},nativeOn:{click:function(t){return e.onEditFile(i)}}},[e._v("编辑")]),o("el-dropdown-item",{attrs:{icon:"el-icon-download",divided:""},nativeOn:{click:function(t){return e.onExport(i)}}},[e._v("导出")]),o("el-dropdown-item",{attrs:{icon:"el-icon-delete",divided:""},nativeOn:{click:function(t){return e.onDelete(i)}}},[e._v("删除")])],1)],1)],1):o("span",[o("i",{staticClass:"el-icon-c-scale-to-original",staticStyle:{color:"#0088cc"}}),o("span",{attrs:{draggable:"true"},on:{dragstart:function(t){return e.onDragStart(i,t)},dragend:function(t){return e.onDragEnd(t)}}},[e._v(" "+e._s(e.pickLabel(n.label)))]),o("el-dropdown",{directives:[{name:"show",rawName:"v-show",value:i.show,expression:"data.show"}],staticStyle:{float:"right",width:"14px",margin:"0 5px"}},[o("span",{staticClass:"el-dropdown-link"},[o("i",{staticClass:"el-icon-more el-icon--right"})]),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[o("el-dropdown-item",{attrs:{icon:"el-icon-edit-outline"},nativeOn:{click:function(t){return e.onEditFile(i)}}},[e._v("编辑")]),o("el-dropdown-item",{attrs:{icon:"el-icon-plus",divided:""},nativeOn:{click:function(t){return e.onNewFile(i)}}},[e._v("新建")]),o("el-dropdown-item",{attrs:{icon:"el-icon-folder-add"},nativeOn:{click:function(t){return e.onNewDir(i)}}},[e._v("新建目录")]),o("el-dropdown-item",{attrs:{icon:"el-icon-delete",divided:""},nativeOn:{click:function(t){return e.onDelete(i)}}},[e._v("删除")])],1)],1),o("el-tooltip",{attrs:{content:"编辑"}},[o("el-button",{directives:[{name:"show",rawName:"v-show",value:i.show,expression:"data.show"}],staticStyle:{float:"right",width:"14px",margin:"0 5px"},attrs:{type:"text",icon:"el-icon-edit-outline"},on:{click:function(t){return t.stopPropagation(),e.onEditFile(i)}}})],1)],1)])}}])}),e.dialog.configNew.show?o("el-dialog",{attrs:{title:e.dialog.configNew.formItem.ifDir?"新增目录":"新增配置",visible:e.dialog.configNew.show,"append-to-body":""},on:{"update:visible":function(t){return e.$set(e.dialog.configNew,"show",t)}}},[o("el-container",[o("el-main",{staticStyle:{padding:"0px 20px",height:"100%",overflow:"auto"}},[o("el-form",{attrs:{model:e.dialog.configNew.formItem,rules:e.dialog.configNew.rules,"label-width":"100","label-position":"top"}},[o("el-form-item",{attrs:{label:"位置",prop:"parent"}},[o("el-input",{attrs:{placeholder:"位置",disabled:!0},model:{value:e.dialog.configNew.formItem.parent,callback:function(t){e.$set(e.dialog.configNew.formItem,"parent",t)},expression:"dialog.configNew.formItem.parent"}})],1),o("el-form-item",{attrs:{label:e.dialog.configNew.formItem.ifDir?"目录":"配置"}},[o("el-switch",{attrs:{"active-color":"#13ce66","active-value":!0,"inactive-value":!1},model:{value:e.dialog.configNew.formItem.ifDir,callback:function(t){e.$set(e.dialog.configNew.formItem,"ifDir",t)},expression:"dialog.configNew.formItem.ifDir"}})],1),o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{attrs:{placeholder:e.dialog.configNew.formItem.ifDir?"目录名称":"配置名称",autofocus:"true"},model:{value:e.dialog.configNew.formItem.name,callback:function(t){e.$set(e.dialog.configNew.formItem,"name",t)},expression:"dialog.configNew.formItem.name"}})],1),o("el-form-item",{attrs:{label:"TTL",prop:"ttl"}},[o("el-input-number",{attrs:{placeholder:"TTL"},model:{value:e.dialog.configNew.formItem.ttl,callback:function(t){e.$set(e.dialog.configNew.formItem,"ttl",t)},expression:"dialog.configNew.formItem.ttl"}})],1),o("el-form-item",{attrs:{label:"值",prop:"value"}},[o("el-input",{attrs:{type:"textarea",placeholder:"配置内容"},model:{value:e.dialog.configNew.formItem.value,callback:function(t){e.$set(e.dialog.configNew.formItem,"value",t)},expression:"dialog.configNew.formItem.value"}})],1)],1)],1),o("el-footer",{staticStyle:{"text-align":"right"}},[o("el-button",{attrs:{type:"default"},on:{click:function(t){e.dialog.configNew.show=!1}}},[e._v("取消")]),o("el-button",{attrs:{type:"primary",loading:e.dialog.configNew.loading},on:{click:e.onConfigSave}},[e._v("提交")])],1)],1)],1):e._e()],1)],1)},i=[],a=(o("4de4"),o("4160"),o("c975"),o("a15b"),o("b0c0"),o("ac1f"),o("8a79"),o("5319"),o("1276"),o("159b"),o("2ef0")),l=o.n(a),r={name:"TreeView",props:{root:String},data:function(){return{auth:window.auth,defaultProps:{children:"nodes",label:"key"},treeData:[],defaultExpandedKeys:["/"],filterText:"",dialog:{configNew:{show:!1,formItem:{parent:"",name:"",key:"",value:"",ttl:null,ifDir:!0},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}]},data:null,loading:!1}}}},watch:{filterText:function(e){l.a.isEmpty(e)?this.initData():this.$refs.tree.filter(e)}},computed:{rootPath:function(){return this.root?this.root:["",this.auth.signedUser.Company.ospace].join("/")}},mounted:function(){this.initData()},methods:{pickTypeFromLabel:function(e,t){return l.a.endsWith(e,t)},pickLabel:function(e){return l.a.last(e.split("/"))},initData:function(){var e=this,t=this.rootPath;this.m3.ruleGet(t).then((function(t){e.treeData=[t.message]}))},onMouseEnter:function(e){this.$set(e,"show",!0),this.$refs.tree.setCurrentKey(e.key)},onMouseLeave:function(e){this.$set(e,"show",!1)},onNodeFilter:function(e,t){return!e||-1!==t.key.indexOf(e)},onCollapseAll:function(){var e=this;l.a.forEach(this.$refs.tree.store._getAllNodes(),(function(t){e.$set(t,"expanded",!1)}))},onRefresh:function(e){var t=this;this.m3.ruleGet(e.key).then((function(o){t.$set(e,"nodes",o.message.nodes)}))},onNodeClick:function(e){this.$emit("node-click",e),this.onRefresh(e)},onDelete:function(e){var t=this,o=e,n=this.$refs.tree.getNode(e.key).parent.data,i=this.$createElement;this.$msgbox({title:"确认要删除以下配置",message:i("span",null,[i("p",null,"位置：".concat(o.key)),i("p",null,"值：".concat(l.a.truncate(o.value))),i("p",null,"TTL：".concat(l.a.isUndefined(o.ttl)?"":o.ttl))]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.m3.ruleDelete(o).then((function(){t.$message.success("删除成功");var e=t.rootPath;o.key==e?t.initData():t.onRefresh(n),t.$emit("node-close",o.key)})).catch((function(e){t.$message.error("删除失败 "+JSON.stringify(e.message))}))})).catch((function(){t.$message.info("取消删除操作")}))},onNewFile:function(e){this.dialog.configNew.formItem.ifDir=!1,this.dialog.configNew.data=e,this.dialog.configNew.formItem.parent=e.key||"/",this.dialog.configNew.show=!0},onNewDir:function(e){this.dialog.configNew.formItem.ifDir=!0,this.dialog.configNew.data=e,this.dialog.configNew.formItem.parent=e.key||"/",this.dialog.configNew.show=!0},onEditFile:function(e){var t=this;this.m3.ruleGet(e.key).then((function(e){t.$emit("node-open",e.message)}))},onResetConfig:function(){this.dialog.configNew.formItem.parent="",this.dialog.configNew.formItem.name="",this.dialog.configNew.data=null,this.dialog.configNew.formItem.key="",this.dialog.configNew.formItem.value="",this.dialog.configNew.formItem.ttl=null,this.dialog.configNew.formItem.ifDir=!0},onConfigSave:function(){var e=this;if(l.a.isEmpty(this.dialog.configNew.formItem.name))return this.$message({type:"warning",message:"配置名称不能为空！"}),!1;this.dialog.configNew.loading=!0,this.dialog.configNew.formItem.key=[this.dialog.configNew.formItem.parent,this.dialog.configNew.formItem.name].join("/").replace(/\/\//g,"/"),this.m3.ruleAdd(this.dialog.configNew.formItem).then((function(){e.$message({type:"success",message:"保存成功！"}),e.onRefresh(e.dialog.configNew.data),e.onResetConfig(),e.dialog.configNew.show=!1,e.dialog.configNew.loading=!1})).catch((function(t){e.$message({type:"error",message:"保存失败："+t.message})}))},onExport:function(e){var t=this,o="";o=l.a.isNull(e)?this.rootPath:e.key,this.$confirm("确认要导出 ".concat(o," 下的配置?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.m3.ruleExport(o).then((function(e){t.$message.success("配置导出成功 "+e)})).catch((function(e){t.$message.error("配置导出失败 "+e)}))})).catch((function(){t.$message({type:"info",message:"已取消导出操作"})}))},onImport:function(e){var t=this,o=e.target.files[0],n=this.$createElement;this.$msgbox({title:"确认要导入配置",message:n("span",null,[n("p",null,"文件名称：".concat(o.name)),n("p",null,"修改时间：".concat(o.lastModifiedDate)),n("p",null,"文件大小：".concat(this.m3.bytesToSize(o.size)))]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",customClass:"rule-messagebox",type:"warning"}).then((function(){t.m3.ruleImport(o).then((function(){t.$message({type:"success",message:"导入成功"}),t.initData(),e.target.value=""})).catch((function(o){t.$message({type:"error",message:"导入失败 "+o}),e.target.value=""}))})).catch((function(){t.$message({type:"info",message:"已取消导入操作"}),e.target.value=""}))},onDragStart:function(e,t){var o={type:"rule",name:e.key,title:e.key};t.dataTransfer.setData("Text",JSON.stringify(o))},onDragEnd:function(e){console.log(e)},onAllowDrag:function(e){return 0===e.childNodes.length}}},s=r,c=(o("fcad"),o("849a"),o("2877")),d=Object(c["a"])(s,n,i,!1,null,"31b5d4a0",null);t["default"]=d.exports},fcad:function(e,t,o){"use strict";o("2763")}}]);